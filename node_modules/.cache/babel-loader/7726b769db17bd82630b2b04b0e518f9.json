{"ast":null,"code":"'use strict';\n\nvar path = require('path'),\n    Stream = require('stream').Stream,\n    Split = require('split'),\n    util = require('util'),\n    defaultPort = 5432,\n    isWin = process.platform === 'win32',\n    warnStream = process.stderr;\n\nvar S_IRWXG = 56 //    00070(8)\n,\n    S_IRWXO = 7 //    00007(8)\n,\n    S_IFMT = 61440 // 00170000(8)\n,\n    S_IFREG = 32768 //  0100000(8)\n;\n\nfunction isRegFile(mode) {\n  return (mode & S_IFMT) == S_IFREG;\n}\n\nvar fieldNames = ['host', 'port', 'database', 'user', 'password'];\nvar nrOfFields = fieldNames.length;\nvar passKey = fieldNames[nrOfFields - 1];\n\nfunction warn() {\n  var isWritable = warnStream instanceof Stream && true === warnStream.writable;\n\n  if (isWritable) {\n    var args = Array.prototype.slice.call(arguments).concat(\"\\n\");\n    warnStream.write(util.format.apply(util, args));\n  }\n}\n\nObject.defineProperty(module.exports, 'isWin', {\n  get: function () {\n    return isWin;\n  },\n  set: function (val) {\n    isWin = val;\n  }\n});\n\nmodule.exports.warnTo = function (stream) {\n  var old = warnStream;\n  warnStream = stream;\n  return old;\n};\n\nmodule.exports.getFileName = function (env) {\n  env = env || process.env;\n  var file = env.PGPASSFILE || (isWin ? path.join(env.APPDATA, 'postgresql', 'pgpass.conf') : path.join(env.HOME, '.pgpass'));\n  return file;\n};\n\nmodule.exports.usePgPass = function (stats, fname) {\n  if (Object.prototype.hasOwnProperty.call(process.env, 'PGPASSWORD')) {\n    return false;\n  }\n\n  if (isWin) {\n    return true;\n  }\n\n  fname = fname || '<unkn>';\n\n  if (!isRegFile(stats.mode)) {\n    warn('WARNING: password file \"%s\" is not a plain file', fname);\n    return false;\n  }\n\n  if (stats.mode & (S_IRWXG | S_IRWXO)) {\n    /* If password file is insecure, alert the user and ignore it. */\n    warn('WARNING: password file \"%s\" has group or world access; permissions should be u=rw (0600) or less', fname);\n    return false;\n  }\n\n  return true;\n};\n\nvar matcher = module.exports.match = function (connInfo, entry) {\n  return fieldNames.slice(0, -1).reduce(function (prev, field, idx) {\n    if (idx == 1) {\n      // the port\n      if (Number(connInfo[field] || defaultPort) === Number(entry[field])) {\n        return prev && true;\n      }\n    }\n\n    return prev && (entry[field] === '*' || entry[field] === connInfo[field]);\n  }, true);\n};\n\nmodule.exports.getPassword = function (connInfo, stream, cb) {\n  var pass;\n  var lineStream = stream.pipe(new Split());\n\n  function onLine(line) {\n    var entry = parseLine(line);\n\n    if (entry && isValidEntry(entry) && matcher(connInfo, entry)) {\n      pass = entry[passKey];\n      lineStream.end(); // -> calls onEnd(), but pass is set now\n    }\n  }\n\n  var onEnd = function () {\n    stream.destroy();\n    cb(pass);\n  };\n\n  var onErr = function (err) {\n    stream.destroy();\n    warn('WARNING: error on reading file: %s', err);\n    cb(undefined);\n  };\n\n  stream.on('error', onErr);\n  lineStream.on('data', onLine).on('end', onEnd).on('error', onErr);\n};\n\nvar parseLine = module.exports.parseLine = function (line) {\n  if (line.length < 11 || line.match(/^\\s+#/)) {\n    return null;\n  }\n\n  var curChar = '';\n  var prevChar = '';\n  var fieldIdx = 0;\n  var startIdx = 0;\n  var endIdx = 0;\n  var obj = {};\n  var isLastField = false;\n\n  var addToObj = function (idx, i0, i1) {\n    var field = line.substring(i0, i1);\n\n    if (!Object.hasOwnProperty.call(process.env, 'PGPASS_NO_DEESCAPE')) {\n      field = field.replace(/\\\\([:\\\\])/g, '$1');\n    }\n\n    obj[fieldNames[idx]] = field;\n  };\n\n  for (var i = 0; i < line.length - 1; i += 1) {\n    curChar = line.charAt(i + 1);\n    prevChar = line.charAt(i);\n    isLastField = fieldIdx == nrOfFields - 1;\n\n    if (isLastField) {\n      addToObj(fieldIdx, startIdx);\n      break;\n    }\n\n    if (i >= 0 && curChar == ':' && prevChar !== '\\\\') {\n      addToObj(fieldIdx, startIdx, i + 1);\n      startIdx = i + 2;\n      fieldIdx += 1;\n    }\n  }\n\n  obj = Object.keys(obj).length === nrOfFields ? obj : null;\n  return obj;\n};\n\nvar isValidEntry = module.exports.isValidEntry = function (entry) {\n  var rules = {\n    // host\n    0: function (x) {\n      return x.length > 0;\n    },\n    // port\n    1: function (x) {\n      if (x === '*') {\n        return true;\n      }\n\n      x = Number(x);\n      return isFinite(x) && x > 0 && x < 9007199254740992 && Math.floor(x) === x;\n    },\n    // database\n    2: function (x) {\n      return x.length > 0;\n    },\n    // username\n    3: function (x) {\n      return x.length > 0;\n    },\n    // password\n    4: function (x) {\n      return x.length > 0;\n    }\n  };\n\n  for (var idx = 0; idx < fieldNames.length; idx += 1) {\n    var rule = rules[idx];\n    var value = entry[fieldNames[idx]] || '';\n    var res = rule(value);\n\n    if (!res) {\n      return false;\n    }\n  }\n\n  return true;\n};","map":{"version":3,"sources":["/Users/dirkstahlecker/programming/word-frequencies-heroku/node_modules/pgpass/lib/helper.js"],"names":["path","require","Stream","Split","util","defaultPort","isWin","process","platform","warnStream","stderr","S_IRWXG","S_IRWXO","S_IFMT","S_IFREG","isRegFile","mode","fieldNames","nrOfFields","length","passKey","warn","isWritable","writable","args","Array","prototype","slice","call","arguments","concat","write","format","apply","Object","defineProperty","module","exports","get","set","val","warnTo","stream","old","getFileName","env","file","PGPASSFILE","join","APPDATA","HOME","usePgPass","stats","fname","hasOwnProperty","matcher","match","connInfo","entry","reduce","prev","field","idx","Number","getPassword","cb","pass","lineStream","pipe","onLine","line","parseLine","isValidEntry","end","onEnd","destroy","onErr","err","undefined","on","curChar","prevChar","fieldIdx","startIdx","endIdx","obj","isLastField","addToObj","i0","i1","substring","replace","i","charAt","keys","rules","x","isFinite","Math","floor","rule","value","res"],"mappings":"AAAA;;AAEA,IAAIA,IAAI,GAAGC,OAAO,CAAC,MAAD,CAAlB;AAAA,IACIC,MAAM,GAAGD,OAAO,CAAC,QAAD,CAAP,CAAkBC,MAD/B;AAAA,IAEIC,KAAK,GAAGF,OAAO,CAAC,OAAD,CAFnB;AAAA,IAGIG,IAAI,GAAGH,OAAO,CAAC,MAAD,CAHlB;AAAA,IAIII,WAAW,GAAG,IAJlB;AAAA,IAKIC,KAAK,GAAIC,OAAO,CAACC,QAAR,KAAqB,OALlC;AAAA,IAMIC,UAAU,GAAGF,OAAO,CAACG,MANzB;;AAUA,IAAIC,OAAO,GAAG,EAAd,CAAqB;AAArB;AAAA,IACIC,OAAO,GAAG,CADd,CACqB;AADrB;AAAA,IAEIC,MAAM,GAAI,KAFd,CAEqB;AAFrB;AAAA,IAGIC,OAAO,GAAG,KAHd,CAGqB;AAHrB;;AAKA,SAASC,SAAT,CAAmBC,IAAnB,EAAyB;AACrB,SAAQ,CAACA,IAAI,GAAGH,MAAR,KAAmBC,OAA3B;AACH;;AAED,IAAIG,UAAU,GAAG,CAAE,MAAF,EAAU,MAAV,EAAkB,UAAlB,EAA8B,MAA9B,EAAsC,UAAtC,CAAjB;AACA,IAAIC,UAAU,GAAGD,UAAU,CAACE,MAA5B;AACA,IAAIC,OAAO,GAAGH,UAAU,CAAEC,UAAU,GAAE,CAAd,CAAxB;;AAGA,SAASG,IAAT,GAAgB;AACZ,MAAIC,UAAU,GACVb,UAAU,YAAYP,MAAtB,IACE,SAASO,UAAU,CAACc,QAF1B;;AAKA,MAAID,UAAJ,EAAgB;AACZ,QAAIE,IAAI,GAAGC,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2BC,SAA3B,EAAsCC,MAAtC,CAA6C,IAA7C,CAAX;AACArB,IAAAA,UAAU,CAACsB,KAAX,CAAkB3B,IAAI,CAAC4B,MAAL,CAAYC,KAAZ,CAAkB7B,IAAlB,EAAwBoB,IAAxB,CAAlB;AACH;AACJ;;AAGDU,MAAM,CAACC,cAAP,CAAsBC,MAAM,CAACC,OAA7B,EAAsC,OAAtC,EAA+C;AAC3CC,EAAAA,GAAG,EAAG,YAAW;AACb,WAAOhC,KAAP;AACH,GAH0C;AAI3CiC,EAAAA,GAAG,EAAG,UAASC,GAAT,EAAc;AAChBlC,IAAAA,KAAK,GAAGkC,GAAR;AACH;AAN0C,CAA/C;;AAUAJ,MAAM,CAACC,OAAP,CAAeI,MAAf,GAAwB,UAASC,MAAT,EAAiB;AACrC,MAAIC,GAAG,GAAGlC,UAAV;AACAA,EAAAA,UAAU,GAAGiC,MAAb;AACA,SAAOC,GAAP;AACH,CAJD;;AAMAP,MAAM,CAACC,OAAP,CAAeO,WAAf,GAA6B,UAASC,GAAT,EAAa;AACtCA,EAAAA,GAAG,GAAGA,GAAG,IAAItC,OAAO,CAACsC,GAArB;AACA,MAAIC,IAAI,GAAGD,GAAG,CAACE,UAAJ,KACPzC,KAAK,GACHN,IAAI,CAACgD,IAAL,CAAWH,GAAG,CAACI,OAAf,EAAyB,YAAzB,EAAuC,aAAvC,CADG,GAEHjD,IAAI,CAACgD,IAAL,CAAWH,GAAG,CAACK,IAAf,EAAqB,SAArB,CAHK,CAAX;AAKA,SAAOJ,IAAP;AACH,CARD;;AAUAV,MAAM,CAACC,OAAP,CAAec,SAAf,GAA2B,UAASC,KAAT,EAAgBC,KAAhB,EAAuB;AAC9C,MAAInB,MAAM,CAACR,SAAP,CAAiB4B,cAAjB,CAAgC1B,IAAhC,CAAqCrB,OAAO,CAACsC,GAA7C,EAAkD,YAAlD,CAAJ,EAAqE;AACjE,WAAO,KAAP;AACH;;AAED,MAAIvC,KAAJ,EAAW;AACP,WAAO,IAAP;AACH;;AAED+C,EAAAA,KAAK,GAAGA,KAAK,IAAI,QAAjB;;AAEA,MAAI,CAAEtC,SAAS,CAACqC,KAAK,CAACpC,IAAP,CAAf,EAA6B;AACzBK,IAAAA,IAAI,CAAC,iDAAD,EAAoDgC,KAApD,CAAJ;AACA,WAAO,KAAP;AACH;;AAED,MAAID,KAAK,CAACpC,IAAN,IAAcL,OAAO,GAAGC,OAAxB,CAAJ,EAAsC;AAClC;AACAS,IAAAA,IAAI,CAAC,kGAAD,EAAqGgC,KAArG,CAAJ;AACA,WAAO,KAAP;AACH;;AAED,SAAO,IAAP;AACH,CAvBD;;AA0BA,IAAIE,OAAO,GAAGnB,MAAM,CAACC,OAAP,CAAemB,KAAf,GAAuB,UAASC,QAAT,EAAmBC,KAAnB,EAA0B;AAC3D,SAAOzC,UAAU,CAACU,KAAX,CAAiB,CAAjB,EAAoB,CAAC,CAArB,EAAwBgC,MAAxB,CAA+B,UAASC,IAAT,EAAeC,KAAf,EAAsBC,GAAtB,EAA0B;AAC5D,QAAIA,GAAG,IAAI,CAAX,EAAc;AACV;AACA,UAAKC,MAAM,CAAEN,QAAQ,CAACI,KAAD,CAAR,IAAmBxD,WAArB,CAAN,KAA6C0D,MAAM,CAAEL,KAAK,CAACG,KAAD,CAAP,CAAxD,EAA2E;AACvE,eAAOD,IAAI,IAAI,IAAf;AACH;AACJ;;AACD,WAAOA,IAAI,KACPF,KAAK,CAACG,KAAD,CAAL,KAAiB,GAAjB,IACEH,KAAK,CAACG,KAAD,CAAL,KAAiBJ,QAAQ,CAACI,KAAD,CAFpB,CAAX;AAIH,GAXM,EAWJ,IAXI,CAAP;AAYH,CAbD;;AAgBAzB,MAAM,CAACC,OAAP,CAAe2B,WAAf,GAA6B,UAASP,QAAT,EAAmBf,MAAnB,EAA2BuB,EAA3B,EAA+B;AACxD,MAAIC,IAAJ;AACA,MAAIC,UAAU,GAAGzB,MAAM,CAAC0B,IAAP,CAAY,IAAIjE,KAAJ,EAAZ,CAAjB;;AAEA,WAASkE,MAAT,CAAgBC,IAAhB,EAAsB;AAClB,QAAIZ,KAAK,GAAGa,SAAS,CAACD,IAAD,CAArB;;AACA,QAAIZ,KAAK,IAAIc,YAAY,CAACd,KAAD,CAArB,IAAgCH,OAAO,CAACE,QAAD,EAAWC,KAAX,CAA3C,EAA8D;AAC1DQ,MAAAA,IAAI,GAAGR,KAAK,CAACtC,OAAD,CAAZ;AACA+C,MAAAA,UAAU,CAACM,GAAX,GAF0D,CAExC;AACrB;AACJ;;AAED,MAAIC,KAAK,GAAG,YAAW;AACnBhC,IAAAA,MAAM,CAACiC,OAAP;AACAV,IAAAA,EAAE,CAACC,IAAD,CAAF;AACH,GAHD;;AAKA,MAAIU,KAAK,GAAG,UAASC,GAAT,EAAc;AACtBnC,IAAAA,MAAM,CAACiC,OAAP;AACAtD,IAAAA,IAAI,CAAC,oCAAD,EAAuCwD,GAAvC,CAAJ;AACAZ,IAAAA,EAAE,CAACa,SAAD,CAAF;AACH,GAJD;;AAMApC,EAAAA,MAAM,CAACqC,EAAP,CAAU,OAAV,EAAmBH,KAAnB;AACAT,EAAAA,UAAU,CACLY,EADL,CACQ,MADR,EACgBV,MADhB,EAEKU,EAFL,CAEQ,KAFR,EAEeL,KAFf,EAGKK,EAHL,CAGQ,OAHR,EAGiBH,KAHjB;AAMH,CA9BD;;AAiCA,IAAIL,SAAS,GAAGnC,MAAM,CAACC,OAAP,CAAekC,SAAf,GAA2B,UAASD,IAAT,EAAe;AACtD,MAAIA,IAAI,CAACnD,MAAL,GAAc,EAAd,IAAoBmD,IAAI,CAACd,KAAL,CAAW,OAAX,CAAxB,EAA6C;AACzC,WAAO,IAAP;AACH;;AAED,MAAIwB,OAAO,GAAG,EAAd;AACA,MAAIC,QAAQ,GAAG,EAAf;AACA,MAAIC,QAAQ,GAAG,CAAf;AACA,MAAIC,QAAQ,GAAG,CAAf;AACA,MAAIC,MAAM,GAAG,CAAb;AACA,MAAIC,GAAG,GAAG,EAAV;AACA,MAAIC,WAAW,GAAG,KAAlB;;AACA,MAAIC,QAAQ,GAAG,UAASzB,GAAT,EAAc0B,EAAd,EAAkBC,EAAlB,EAAsB;AACjC,QAAI5B,KAAK,GAAGS,IAAI,CAACoB,SAAL,CAAeF,EAAf,EAAmBC,EAAnB,CAAZ;;AAEA,QAAI,CAAEvD,MAAM,CAACoB,cAAP,CAAsB1B,IAAtB,CAA2BrB,OAAO,CAACsC,GAAnC,EAAwC,oBAAxC,CAAN,EAAqE;AACjEgB,MAAAA,KAAK,GAAGA,KAAK,CAAC8B,OAAN,CAAc,YAAd,EAA4B,IAA5B,CAAR;AACH;;AAEDN,IAAAA,GAAG,CAAEpE,UAAU,CAAC6C,GAAD,CAAZ,CAAH,GAAyBD,KAAzB;AACH,GARD;;AAUA,OAAK,IAAI+B,CAAC,GAAG,CAAb,EAAiBA,CAAC,GAAGtB,IAAI,CAACnD,MAAL,GAAY,CAAjC,EAAqCyE,CAAC,IAAI,CAA1C,EAA6C;AACzCZ,IAAAA,OAAO,GAAGV,IAAI,CAACuB,MAAL,CAAYD,CAAC,GAAC,CAAd,CAAV;AACAX,IAAAA,QAAQ,GAAGX,IAAI,CAACuB,MAAL,CAAYD,CAAZ,CAAX;AAEAN,IAAAA,WAAW,GAAIJ,QAAQ,IAAIhE,UAAU,GAAC,CAAtC;;AAEA,QAAIoE,WAAJ,EAAiB;AACbC,MAAAA,QAAQ,CAACL,QAAD,EAAWC,QAAX,CAAR;AACA;AACH;;AAED,QAAIS,CAAC,IAAI,CAAL,IAAUZ,OAAO,IAAI,GAArB,IAA4BC,QAAQ,KAAK,IAA7C,EAAmD;AAC/CM,MAAAA,QAAQ,CAACL,QAAD,EAAWC,QAAX,EAAqBS,CAAC,GAAC,CAAvB,CAAR;AAEAT,MAAAA,QAAQ,GAAGS,CAAC,GAAC,CAAb;AACAV,MAAAA,QAAQ,IAAI,CAAZ;AACH;AACJ;;AAEDG,EAAAA,GAAG,GAAKnD,MAAM,CAAC4D,IAAP,CAAYT,GAAZ,EAAiBlE,MAAjB,KAA4BD,UAA9B,GAA6CmE,GAA7C,GAAmD,IAAzD;AAEA,SAAOA,GAAP;AACH,CA5CD;;AA+CA,IAAIb,YAAY,GAAGpC,MAAM,CAACC,OAAP,CAAemC,YAAf,GAA8B,UAASd,KAAT,EAAe;AAC5D,MAAIqC,KAAK,GAAG;AACR;AACA,OAAI,UAASC,CAAT,EAAW;AACX,aAAOA,CAAC,CAAC7E,MAAF,GAAW,CAAlB;AACH,KAJO;AAKR;AACA,OAAI,UAAS6E,CAAT,EAAW;AACX,UAAIA,CAAC,KAAK,GAAV,EAAe;AACX,eAAO,IAAP;AACH;;AACDA,MAAAA,CAAC,GAAGjC,MAAM,CAACiC,CAAD,CAAV;AACA,aACIC,QAAQ,CAACD,CAAD,CAAR,IACEA,CAAC,GAAG,CADN,IAEEA,CAAC,GAAG,gBAFN,IAGEE,IAAI,CAACC,KAAL,CAAWH,CAAX,MAAkBA,CAJxB;AAMH,KAjBO;AAkBR;AACA,OAAI,UAASA,CAAT,EAAW;AACX,aAAOA,CAAC,CAAC7E,MAAF,GAAW,CAAlB;AACH,KArBO;AAsBR;AACA,OAAI,UAAS6E,CAAT,EAAW;AACX,aAAOA,CAAC,CAAC7E,MAAF,GAAW,CAAlB;AACH,KAzBO;AA0BR;AACA,OAAI,UAAS6E,CAAT,EAAW;AACX,aAAOA,CAAC,CAAC7E,MAAF,GAAW,CAAlB;AACH;AA7BO,GAAZ;;AAgCA,OAAK,IAAI2C,GAAG,GAAG,CAAf,EAAmBA,GAAG,GAAG7C,UAAU,CAACE,MAApC,EAA6C2C,GAAG,IAAI,CAApD,EAAuD;AACnD,QAAIsC,IAAI,GAAGL,KAAK,CAACjC,GAAD,CAAhB;AACA,QAAIuC,KAAK,GAAG3C,KAAK,CAAEzC,UAAU,CAAC6C,GAAD,CAAZ,CAAL,IAA4B,EAAxC;AAEA,QAAIwC,GAAG,GAAGF,IAAI,CAACC,KAAD,CAAd;;AACA,QAAI,CAACC,GAAL,EAAU;AACN,aAAO,KAAP;AACH;AACJ;;AAED,SAAO,IAAP;AACH,CA5CD","sourcesContent":["'use strict';\n\nvar path = require('path')\n  , Stream = require('stream').Stream\n  , Split = require('split')\n  , util = require('util')\n  , defaultPort = 5432\n  , isWin = (process.platform === 'win32')\n  , warnStream = process.stderr\n;\n\n\nvar S_IRWXG = 56     //    00070(8)\n  , S_IRWXO = 7      //    00007(8)\n  , S_IFMT  = 61440  // 00170000(8)\n  , S_IFREG = 32768  //  0100000(8)\n;\nfunction isRegFile(mode) {\n    return ((mode & S_IFMT) == S_IFREG);\n}\n\nvar fieldNames = [ 'host', 'port', 'database', 'user', 'password' ];\nvar nrOfFields = fieldNames.length;\nvar passKey = fieldNames[ nrOfFields -1 ];\n\n\nfunction warn() {\n    var isWritable = (\n        warnStream instanceof Stream &&\n          true === warnStream.writable\n    );\n\n    if (isWritable) {\n        var args = Array.prototype.slice.call(arguments).concat(\"\\n\");\n        warnStream.write( util.format.apply(util, args) );\n    }\n}\n\n\nObject.defineProperty(module.exports, 'isWin', {\n    get : function() {\n        return isWin;\n    } ,\n    set : function(val) {\n        isWin = val;\n    }\n});\n\n\nmodule.exports.warnTo = function(stream) {\n    var old = warnStream;\n    warnStream = stream;\n    return old;\n};\n\nmodule.exports.getFileName = function(env){\n    env = env || process.env;\n    var file = env.PGPASSFILE || (\n        isWin ?\n          path.join( env.APPDATA , 'postgresql', 'pgpass.conf' ) :\n          path.join( env.HOME, '.pgpass' )\n    );\n    return file;\n};\n\nmodule.exports.usePgPass = function(stats, fname) {\n    if (Object.prototype.hasOwnProperty.call(process.env, 'PGPASSWORD')) {\n        return false;\n    }\n\n    if (isWin) {\n        return true;\n    }\n\n    fname = fname || '<unkn>';\n\n    if (! isRegFile(stats.mode)) {\n        warn('WARNING: password file \"%s\" is not a plain file', fname);\n        return false;\n    }\n\n    if (stats.mode & (S_IRWXG | S_IRWXO)) {\n        /* If password file is insecure, alert the user and ignore it. */\n        warn('WARNING: password file \"%s\" has group or world access; permissions should be u=rw (0600) or less', fname);\n        return false;\n    }\n\n    return true;\n};\n\n\nvar matcher = module.exports.match = function(connInfo, entry) {\n    return fieldNames.slice(0, -1).reduce(function(prev, field, idx){\n        if (idx == 1) {\n            // the port\n            if ( Number( connInfo[field] || defaultPort ) === Number( entry[field] ) ) {\n                return prev && true;\n            }\n        }\n        return prev && (\n            entry[field] === '*' ||\n              entry[field] === connInfo[field]\n        );\n    }, true);\n};\n\n\nmodule.exports.getPassword = function(connInfo, stream, cb) {\n    var pass;\n    var lineStream = stream.pipe(new Split());\n\n    function onLine(line) {\n        var entry = parseLine(line);\n        if (entry && isValidEntry(entry) && matcher(connInfo, entry)) {\n            pass = entry[passKey];\n            lineStream.end(); // -> calls onEnd(), but pass is set now\n        }\n    }\n\n    var onEnd = function() {\n        stream.destroy();\n        cb(pass);\n    };\n\n    var onErr = function(err) {\n        stream.destroy();\n        warn('WARNING: error on reading file: %s', err);\n        cb(undefined);\n    };\n\n    stream.on('error', onErr);\n    lineStream\n        .on('data', onLine)\n        .on('end', onEnd)\n        .on('error', onErr)\n    ;\n\n};\n\n\nvar parseLine = module.exports.parseLine = function(line) {\n    if (line.length < 11 || line.match(/^\\s+#/)) {\n        return null;\n    }\n\n    var curChar = '';\n    var prevChar = '';\n    var fieldIdx = 0;\n    var startIdx = 0;\n    var endIdx = 0;\n    var obj = {};\n    var isLastField = false;\n    var addToObj = function(idx, i0, i1) {\n        var field = line.substring(i0, i1);\n\n        if (! Object.hasOwnProperty.call(process.env, 'PGPASS_NO_DEESCAPE')) {\n            field = field.replace(/\\\\([:\\\\])/g, '$1');\n        }\n\n        obj[ fieldNames[idx] ] = field;\n    };\n\n    for (var i = 0 ; i < line.length-1 ; i += 1) {\n        curChar = line.charAt(i+1);\n        prevChar = line.charAt(i);\n\n        isLastField = (fieldIdx == nrOfFields-1);\n\n        if (isLastField) {\n            addToObj(fieldIdx, startIdx);\n            break;\n        }\n\n        if (i >= 0 && curChar == ':' && prevChar !== '\\\\') {\n            addToObj(fieldIdx, startIdx, i+1);\n\n            startIdx = i+2;\n            fieldIdx += 1;\n        }\n    }\n\n    obj = ( Object.keys(obj).length === nrOfFields ) ? obj : null;\n\n    return obj;\n};\n\n\nvar isValidEntry = module.exports.isValidEntry = function(entry){\n    var rules = {\n        // host\n        0 : function(x){\n            return x.length > 0;\n        } ,\n        // port\n        1 : function(x){\n            if (x === '*') {\n                return true;\n            }\n            x = Number(x);\n            return (\n                isFinite(x) &&\n                  x > 0 &&\n                  x < 9007199254740992 &&\n                  Math.floor(x) === x\n            );\n        } ,\n        // database\n        2 : function(x){\n            return x.length > 0;\n        } ,\n        // username\n        3 : function(x){\n            return x.length > 0;\n        } ,\n        // password\n        4 : function(x){\n            return x.length > 0;\n        }\n    };\n\n    for (var idx = 0 ; idx < fieldNames.length ; idx += 1) {\n        var rule = rules[idx];\n        var value = entry[ fieldNames[idx] ] || '';\n\n        var res = rule(value);\n        if (!res) {\n            return false;\n        }\n    }\n\n    return true;\n};\n\n"]},"metadata":{},"sourceType":"script"}